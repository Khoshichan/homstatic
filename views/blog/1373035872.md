## Drupal: Form API Snippets
- - -

### #states with OR construction

    'visible' => array(
      array(
        ':input[name="country"]' => array(
          array("value" => 'Canada'),
          array("value" => 'USA'),
        ),
      ),
    ),

### #states with regular expressions
`#states` is a new Form API property in Drupal 7. It makes it easy to change the state (unchecked, visible, enabled, etc.) of an element based on the state of another element. 

Unfortunately it doesn’t support regular expressions out of the box. Add the following code snippet to a suitable javascript file:

    Drupal.behaviors.statesModification = {
      weight: -10, 
      attach: function(context, settings) { 
        if (Drupal.states) { 
          Drupal.states.Dependent.comparisons.Object = function(reference, value) { 
            return ('regex' in reference)
              ? (new RegExp(reference.regex, reference.flags)).test(value)
              : reference.indexOf(value) !== false;
          } 
        } 
      }
    }

If your form element ever loads via AJAX, you’ll need the [Behavior Weights](https://drupal.org/project/behavior_weights) module for this trick to work: this behavior needs to run before the Drupal.behaviors.states behavior.

Now all we need to do is write:

    'visible' => array(
      ':input[name="country"]' => array('value' => array('regex' => '^(Canada|USA)$')),
    ),

### Include file for FORM validate/submit
Use this function instead of module_load_include() from inside a form constructor or any form processing logic as it ensures that the include file is loaded whenever the form is processed. In contrast to using module_load_include() directly, form_load_include() makes sure the include file is correctly loaded also if the form is cached.

    /**
     * Implements hook_form_BASE_FORM_ID_alter().
     */
    function hook_form_BASE_FORM_ID_alter(&$form, &$form_state) {
      form_load_include($form_state, 'inc', 'module_name', 'module_name.page');
    }

